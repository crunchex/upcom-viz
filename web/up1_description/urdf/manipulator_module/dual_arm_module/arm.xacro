<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="up1">

  <xacro:include filename="$(find up1_description)/urdf/manipulator_module/dual_arm_module/arm.gazebo.xacro" />
  <xacro:include filename="$(find up1_description)/urdf/manipulator_module/dual_arm_module/arm.transmission.xacro" />

  <xacro:property name="armlink1_offset_x" value="0.01777" />
  <xacro:property name="armlink1_offset_y" value="0.07385" />
  <xacro:property name="armlink1_offset_z" value="0.01853" />

  <xacro:property name="armlink2_offset_x" value="0" />
  <xacro:property name="armlink2_offset_y" value="0" />
  <xacro:property name="armlink2_offset_z" value="-0.07038" />

  <xacro:property name="armlink3_offset_x" value="0" />
  <xacro:property name="armlink3_offset_y" value="0.09602" />
  <xacro:property name="armlink3_offset_z" value="0" />

  <xacro:property name="armlink4_offset_x" value="0" />
  <xacro:property name="armlink4_offset_y" value="0" />
  <xacro:property name="armlink4_offset_z" value="0.05588" />

  <xacro:property name="gripper_offset_x" value="0" />
  <xacro:property name="gripper_offset_y" value="0.07641" />
  <xacro:property name="gripper_offset_z" value="0" />

  <xacro:property name="armlink1_limit_lower" value="${-pi/2}" />
  <xacro:property name="armlink1_limit_upper" value="${pi/2}" />
  <xacro:property name="armlink2_limit_lower" value="${-pi/2}" />
  <xacro:property name="armlink2_limit_upper" value="${pi/2}" />
  <xacro:property name="armlink3_limit_lower" value="${-pi/2}" />
  <xacro:property name="armlink3_limit_upper" value="${pi/2}" />
  <xacro:property name="armlink4_limit_lower" value="${-pi/2}" />
  <xacro:property name="armlink4_limit_upper" value="${pi/2}" />
  <xacro:property name="gripper_limit_lower" value="${-pi/2}" />
  <xacro:property name="gripper_limit_upper" value="${pi/2}" />
  <xacro:property name="finger_limit_upper" value="0.018" />

  <xacro:property name="armlink1_velocity" value="1" />
  <xacro:property name="armlink2_velocity" value="1" />
  <xacro:property name="armlink3_velocity" value="1" />
  <xacro:property name="armlink4_velocity" value="1" />
  <xacro:property name="gripper_velocity" value="1" />
  <xacro:property name="finger1_velocity" value="1" />
  <xacro:property name="finger2_velocity" value="1" />

  <xacro:property name="armlink1_effort" value="6.0" />
  <xacro:property name="armlink2_effort" value="6.0" />
  <xacro:property name="armlink3_effort" value="6.0" />
  <xacro:property name="armlink4_effort" value="6.0" />
  <xacro:property name="gripper_effort" value="6.0" />
  <xacro:property name="finger1_effort" value="6.0" />
  <xacro:property name="finger2_effort" value="6.0" />

  <xacro:macro name="arm" params="prefix reflect">
    <!-- ============================   Arm   ============================ -->

    <!-- Arm Joint 1 -->
    <joint name="${prefix}_armroot_to_armlink1" type="revolute">
      <parent link="armroot_link" />
      <child link="${prefix}_armlink1" />
      <origin rpy="${-reflect*pi/6} ${pi} 0"
        xyz="${armlink1_offset_x} ${-reflect*armlink1_offset_y} ${armlink1_offset_z}" />
      <axis xyz="0 0 1" />
      <limit lower="${armlink1_limit_lower}" upper="${armlink1_limit_upper}" velocity="${armlink1_velocity}" effort="${armlink1_effort}" />
    </joint>
    <!-- Arm Link 1 -->
    <link name="${prefix}_armlink1">
      <visual>
        <geometry>
          <mesh filename="package://up1_description/meshes/dual_arm/armlink1.stl" scale="0.001 0.001 0.001" />
        </geometry>
        <material name="white" />
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://up1_description/meshes/dual_arm/armlink1.stl" scale="0.001 0.001 0.001" />
        </geometry>
      </collision>
      <inertial>
        <mass value="0.06985"/>
        <inertia ixx="0.00023448766" ixy="0.0000000027" ixz="0.00000001913"
                 iyy="0.00024004726" iyz="-0.0000015393" izz="0.00007431363"/>
      </inertial>
    </link>

    <!-- Arm Joint 2 -->
    <joint name="${prefix}_armlink1_to_armlink2" type="revolute">
      <parent link="${prefix}_armlink1" />
      <child link="${prefix}_armlink2" />
      <origin rpy="${pi/2} ${pi} 0"
        xyz="${armlink2_offset_x} ${armlink2_offset_y} ${armlink2_offset_z}" />
      <axis xyz="0 0 ${reflect*1}" />
      <limit lower="${armlink2_limit_lower}" upper="${armlink2_limit_upper}" velocity="${armlink2_velocity}" effort="${armlink2_effort}" />
    </joint>
    <!-- Arm Link 2 -->
    <link name="${prefix}_armlink2">
      <visual>
        <geometry>
          <mesh filename="package://up1_description/meshes/dual_arm/armlink2.stl" scale="0.001 0.001 0.001" />
        </geometry>
        <material name="white" />
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://up1_description/meshes/dual_arm/armlink2.stl" scale="0.001 0.001 0.001" />
        </geometry>
      </collision>
      <inertial>
        <mass value="0.07067"/>
        <inertia ixx="0.00029708797" ixy="-0.00000000444" ixz="0.00000000068"
                 iyy="0.0000799845" iyz="-0.00000174097" izz="0.00026073683"/>
      </inertial>
    </link>

    <!-- Arm Joint 3 -->
    <joint name="${prefix}_armlink2_to_armlink3" type="revolute">
      <parent link="${prefix}_armlink2" />
      <child link="${prefix}_armlink3" />
      <origin rpy="${-pi/2} ${pi} 0"
        xyz="${armlink3_offset_x} ${armlink3_offset_y} ${armlink3_offset_z}" />
      <axis xyz="0 0 -1" />
      <limit lower="${armlink3_limit_lower}" upper="${armlink3_limit_upper}" velocity="${armlink3_velocity}" effort="${armlink3_effort}" />
    </joint>
    <!-- Arm Link 3 -->
    <link name="${prefix}_armlink3">
      <visual>
        <geometry>
          <mesh filename="package://up1_description/meshes/dual_arm/armlink3.stl" scale="0.001 0.001 0.001" />
        </geometry>
        <material name="white" />
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://up1_description/meshes/dual_arm/armlink3.stl" scale="0.001 0.001 0.001" />
        </geometry>
      </collision>
      <inertial>
        <mass value="0.04828"/>
        <inertia ixx="0.00010408822" ixy="0.00000002684" ixz="0.00000006554"
                 iyy="0.00008358122" iyz="0.00000001571" izz="0.00004453887"/>
      </inertial>
    </link>

    <!-- Arm Joint 4 -->
    <joint name="${prefix}_armlink3_to_armlink4" type="revolute">
      <parent link="${prefix}_armlink3" />
      <child link="${prefix}_armlink4" />
      <origin rpy="${pi/2} 0 0"
        xyz="${armlink4_offset_x} ${armlink4_offset_y} ${armlink4_offset_z}" />
      <axis xyz="0 0 ${reflect*1}" />
      <limit lower="${armlink4_limit_lower}" upper="${armlink4_limit_upper}" velocity="${armlink4_velocity}" effort="${armlink4_effort}" />
    </joint>
    <!-- Arm Link 4 -->
    <link name="${prefix}_armlink4">
      <visual>
        <geometry>
          <mesh filename="package://up1_description/meshes/dual_arm/armlink4.stl" scale="0.001 0.001 0.001" />
        </geometry>
        <material name="white" />
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://up1_description/meshes/dual_arm/armlink4.stl" scale="0.001 0.001 0.001" />
        </geometry>
      </collision>
      <inertial>
        <mass value="0.07021"/>
        <inertia ixx="0.00022365714" ixy="0.00000581335" ixz="-0.00000002583"
                 iyy="0.00004497277" iyz="0.00000036702" izz="0.00022294807"/>
      </inertial>
    </link>

    <!-- Arm Joint 5 -->
    <joint name="${prefix}_armlink4_to_gripper" type="revolute">
      <parent link="${prefix}_armlink4" />
      <child link="${prefix}_gripper" />
      <origin rpy="0 ${pi/2} 0"
        xyz="${gripper_offset_x} ${gripper_offset_y} ${gripper_offset_z}" />
      <axis xyz="0 0 ${-reflect*1}" />
      <limit lower="${gripper_limit_lower}" upper="${gripper_limit_upper}" velocity="${gripper_velocity}" effort="${gripper_effort}" />
    </joint>
    <!-- Gripper Link -->
    <link name="${prefix}_gripper">
      <visual>
        <geometry>
          <mesh filename="package://up1_description/meshes/dual_arm/armlink5.stl" scale="0.001 0.001 0.001" />
        </geometry>
        <material name="white" />
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://up1_description/meshes/dual_arm/armlink5.stl" scale="0.001 0.001 0.001" />
        </geometry>
      </collision>
      <inertial>
        <mass value="0.07134"/>
        <inertia ixx="0.00024486788" ixy="-0.00000179765" ixz="-0.0000013121"
                 iyy="0.00007141374" iyz="0.00000015595" izz="0.0002397239"/>
      </inertial>
    </link>

    <xacro:arm_gazebo prefix="${prefix}" />
    <xacro:arm_transmission prefix="${prefix}" />

  </xacro:macro>

</robot>
